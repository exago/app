machine:
  timezone:
    Europe/Warsaw
  node:
    version: 4.1.0
  services:
    - docker
  environment:
    TAG: latest

dependencies:
  override:
    - npm install -g bower gulp
    - npm install
    - bower install --production --allow-root --config.interactive=false
    - gulp download:fonts

test:
  pre:
    - gulp serve:dist:
          background: true
    - sleep 20
  override:
    - curl http://localhost:3000

deployment:
  release:
    branch: master
    commands:
      - npm dedupe
      - docker login -u $REGISTRY_USERNAME -p $REGISTRY_PASSWORD -e $REGISTRY_EMAIL
      - docker build -t jgautheron/exago:$TAG .
      - docker push jgautheron/exago:$TAG
      #- docker run -v $(which docker):/bin/docker -v /var/run/docker.sock:/var/run/docker.sock jgautheron/exago-builder
