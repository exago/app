<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- Iron elements -->
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<!-- Paper elements -->
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">

<dom-module id="linter-card">
  <template>
    <style include="shared-styles">
      :host {
        position: relative;
        display: block;
        @apply(--shadow-elevation-2dp);
        min-height: 120px;
      }

      :host h2 {
        @apply(--paper-font-display1);
        font-weight: 300;
        margin: 0 0 20px 0;
      }

      :host .main-column {
        @apply(--layout-flex-11);
        text-align: left;
      }

      :host .side-column {
        @apply(--layout-flex-1);
        text-align: left;
      }
      :host .side-column paper-toggle-button {
        display: block;
      }

      :host .linter-toggles {
        margin-top: 16px;
      }

      :host .file-name {
        @apply(--paper-font-title);
        font-weight: 300;
      }
      :host .file-name ~ dd > dl {
        margin-top: 0;
      }
      :host .file-name ~ dd {
        margin-left: 10px;
      }

      :host .linter-results {
        margin-bottom: 0;
      }
      :host .linter-results dt, :host .linter-results dd {
        display: inline-block;
        vertical-align: top;
      }
      :host .linter-results dt {
        width: 100px;
      }
      :host .linter-results dt iron-icon {
        opacity: 0.2;
        cursor: pointer;
      }
      :host .linter-results dt iron-icon:hover {
        opacity: 1;
      }
      :host .linter-results dt + dd {
        margin-left: 10px;
      }
      :host .linter-results dd.messages {
        display: none;
        margin-left: 0;
      }
      :host .linter-results dd.messages ul {
        margin: 0;
      }
      :host .linter-results em {
        font-size: 10px;
        font-style: normal;
        position: relative;
        top: -1px;
      }
      :host .linter-results.collapsed dd.messages {
        display: block;
      }
      :host .linter-results.collapsed dt iron-icon {
        transform: rotate(90deg);
        opacity: 0.8;
      }
      :host .horizontal-bar {
        display: inline-block;
        height: 10px;
        background: var(--default-primary-color);
      }

      :host .Linter-loading {
        position: absolute;
        top: 60px;
        left: 16px;
        right: 16px;
      }
      :host .Linter-loading span {
        @apply(--paper-font-title);
      }

      :host .results {
        display: none;
      }
    </style>

    <h2>Results</h2>
    <div id="linterResults" class="results">
      <div class="layout horizontal">
        <div class="main-column">
          <dl>
            <template is="dom-repeat" items="{{messages}}" filter="{{computeFilter(filterString)}}">
              <template is="dom-if" if="{{_hasVisibleLinters(item)}}">
                <dt class="file-name">
                  <a href$="/project/{{repository}}/file/{{item.name}}" foo="bar">{{item.name}}</a>
                </dt>
                <template is="dom-repeat" items="{{item.value}}" filter="{{computeLinters(item.value)}}">
                  <dd>
                    <dl class="linter-results">
                      <dt>{{item.name}}<iron-icon icon="chevron-right" on-click="_showMessages"></iron-icon></dt>
                      <dd>
                        <span class="horizontal-bar" style$="width: {{item.value.length}}px"></span>
                        <em>{{item.value.length}}</em>
                      </dd>
                      <dd class="messages">
                        <ul>
                          <template is="dom-repeat" items="{{item.value}}">
                            <li><em>line {{item.line}}</em> {{item.message}}</li>
                          </template>
                        </ul>
                      </dd>
                  </dd>
                </template>
              </template>
            </template>
          </dl>
        </div>
        <div class="side-column">
          <paper-input label="Filter by filename" class="search" value="{{filterString::input}}">
            <div suffix>.go</div>
          </paper-input>
          <div class="linter-toggles">
            <template is="dom-repeat" id="linters" items="{{linters}}">
              <paper-toggle-button id="toggle-{{item}}" on-click="_toggleLinter" disabled>{{item}}</paper-toggle-button>
            </template>
          </div>
        </div>
      </div>
    </div>

  </template>

  <script src="linter-card.js"></script>

</dom-module>
